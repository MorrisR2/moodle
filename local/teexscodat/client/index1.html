<html>

<script type="text/javascript" src="rpc.js"></script>
<script type="text/javascript">


	var token = '75f0e435c793bccd744d03a3d09309ac';
	var serverurl = '/webservice/xmlrpc/server.php' + '?wstoken=' + token;
	var course_session_id;

	function course_sess2db(session) {
		var service = new rpc.ServiceProxy(serverurl, {asynchronous:false, protocol: "XML-RPC"});
		try { session = service.local_teexscodat_course_session(session); }
			catch(e){ alert("Unable to update session because: " + e); }
		return session;
	}


        function module_sess2db(session) {
                var service = new rpc.ServiceProxy(serverurl, {asynchronous:false, protocol: "XML-RPC"});
                try { session = service.local_teexscodat_module_session(session); }
                        catch(e){ alert("Unable to update session because: " + e); }
                return session;
        }

        function quiz_sess2db(session) {
                var service = new rpc.ServiceProxy(serverurl, {asynchronous:false, protocol: "XML-RPC"});
                try { session = service.local_teexscodat_quiz_session(session); }
                        catch(e){ alert("Unable to update session because: " + e); }
                return session;
        }

	function save_course() {
		var session = new Object;
		session.student_id = 1;
		session.course_id  = 2;
		session = course_sess2db(session);
		course_session_id = session.id;
        	alert("session id number is: " + course_session_id);
        	return session;
	}

	function update_course() {
        	var session = new Object;
        	session.id = course_session_id;
        	session.pct_completed = 25;
        	session = course_sess2db(session);
        	alert("student ID is still " + session.student_id);
        	return session;
	}

</script>
<body>

<h2>Local custom session data web service sample</h2>
<button value="update course" onClick="save_course();">Create / Save Course</button>
<button value="update course" onClick="update_course();">Update Course</button>

<p>This web service saves local data about course ssions, module sessions, and quiz sessions.</p>
<p>
"View source" to see how to use it.  Note that you call the same function,  course_sess2db(session), to save a new session, update a session you created previously, or retrieve a session. The service does whatever makes sense with what you pass it.  If session.id is set, it updates the session with whatever fields you set. In all cases, it returns the current state of the session object.
</p>

<p>
Full reference documentation can be found under local_* in the 
<a href="../../../admin/webservice/documentation.php" target="_new">Moodle web service documentation</a>.
</p>

</body>
</html>

